usb-relay - USB relay control module
====================================

usb-relay is a quick 'n dirty relay controller based on two very cheap
off-the-shelf boards.

image::images/combined_boards.jpg["Assembled usb-relay device"]

Quickstart
----------

- Install gcc-arm-embedded compiler toolchain (or similar arm-none-eabi-
  compiler).
- +make+
- Use JTAG/SWD programmer to install the booloader. Either
  +make -C src/bootloader flash+ for STLink v2 or
  +make -C src/bootloader BMP_PORT=/dev/ttyACM0 flash+ for a Black Magic Probe.
- Use the bootloader to install the main application using the microcontroller
  boards own USB socket:
  +make -C src/stm32f1-relay flash+

Hardware setup
--------------

The firmware can be easily ported but has been tested on an small 
STM32F103C8T6 based breakout board. Connections required are:

- USB to host computer
- 5v and GND to relay board
- GPIOB 12-15  ->  relay 1-4
- GPIOA  8-10  ->  relay 5-7
- GPIOB  7     ->  relay 8

Usage
-----

The firmware registers itself as a CDC-ACM device and, under Linux, will
be presented as ttyACMx where x is typically 0 on "simple" machines
although will be larger if there is any USB communication or modem device
installed (for example an unused 3G modem).

Type +help+ to get a list of available commands. On STM32F1 platforms
the commands available are:

- +echo+ - test command that echos back its input
- +help+ - shows a list of commands
- +reboot+ - reboot into DFU mode to allows a firmware upgrade (firmware
  upgrade mode can also be triggered by resetting the board whilst leaving
  it plugged into the host)
- +relay1+ to +relay8+ - can be used to turn the relay
  on or off as well as toggling its state or sending a 1 second pulse
- +uptime+ - show time since power on

Example hardware
----------------

usb-relay should readily port to most STM32-based microcontroller boards.
However the following example hardware is easily (and cheaply) availabe and
will work out-of-the-box.

http://item.taobao.com/item.htm?spm=a1z10.1.w4004-386456545.4.3eifcC&id=22097803050[STM32F103C8T6 microcontroller development board] from vcc-gnd.com. Normally very easy to source on eBay.

image::images/stm32f103c8t6_dev_board.jpg["STM32F103C8T6 microcontroller development board"]

Other suitable boards include the STM32F4Discovery and the Olimex H103.

http://hobbycomponents.com/relays/88-8-channel-5v-relay-module[Eight channel relay board] from specialist supplier (or eBay)

image::images/relay_board.jpg["Eight channel relay board"]
